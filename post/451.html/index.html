<!DOCTYPE html>
<html lang="en-us">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Source Themes Academic 4.5.0">

  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="Runhan Yu">

  
  
  
    
  
  <meta name="description" content="This is my implementaion on the Django tutorial.
Create Django project and a polls app First, I verify my Django installation and version by:
python -m django --version  If Python (use 3 here) or Django (1.11.23 here) is not installed, go by:
brew install python mkdir ~/.venvs/venv python3 -m venv ~/.venvs/venv source ~/.venvs/venv/bin/activate pip install django==1.11.23 pip install psycopg2  Now I could create a project with a collection of settings for an instance of Django.">

  
  <link rel="alternate" hreflang="en-us" href="/post/451.html/">

  


  
  
  
  <meta name="theme-color" content="rgb(251, 191, 183)">
  

  
  
  
  
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.0/css/all.css" integrity="sha384-aOkxzJ5uQz7WBObEZcHvV5JvRW3TUc2rNPA7pe3AwnsUohiw1Vj2Rgx2KSOkF5+h" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.css" integrity="sha256-ygkqlh3CYSUri3LhQxzdcm0n1EQvH2Y+U5S2idbLtxs=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/github.min.css" crossorigin="anonymous" title="hl-light">
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/dracula.min.css" crossorigin="anonymous" title="hl-dark" disabled>
        
      
    

    

    

  

  
  
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro%7CLora:400,700%7CSource+Serif+Pro:400,700&display=swap">
  

  
  
  
  <link rel="stylesheet" href="/css/academic.min.cd1d04c8beda9bdca8f807d7f75dafdb.css">

  

  
  
  

  

  <link rel="manifest" href="/index.webmanifest">
  <link rel="icon" type="image/png" href="/img/icon-32.png">
  <link rel="apple-touch-icon" type="image/png" href="/img/icon-192.png">

  <link rel="canonical" href="/post/451.html/">

  
  
  
  
    
    
  
  
  <meta property="twitter:card" content="summary">
  
  <meta property="og:site_name" content="RUNHAN YU">
  <meta property="og:url" content="/post/451.html/">
  <meta property="og:title" content="My first Django app | RUNHAN YU">
  <meta property="og:description" content="This is my implementaion on the Django tutorial.
Create Django project and a polls app First, I verify my Django installation and version by:
python -m django --version  If Python (use 3 here) or Django (1.11.23 here) is not installed, go by:
brew install python mkdir ~/.venvs/venv python3 -m venv ~/.venvs/venv source ~/.venvs/venv/bin/activate pip install django==1.11.23 pip install psycopg2  Now I could create a project with a collection of settings for an instance of Django."><meta property="og:image" content="/img/icon-192.png">
  <meta property="twitter:image" content="/img/icon-192.png"><meta property="og:locale" content="en-us">
  
    
      <meta property="article:published_time" content="2019-10-11T13:58:00-07:00">
    
    <meta property="article:modified_time" content="2019-11-05T22:49:41-08:00">
  

  


    






  






<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "/post/451.html/"
  },
  "headline": "My first Django app",
  
  "datePublished": "2019-10-11T13:58:00-07:00",
  "dateModified": "2019-11-05T22:49:41-08:00",
  
  "author": {
    "@type": "Person",
    "name": "Runhan Yu"
  },
  
  "publisher": {
    "@type": "Organization",
    "name": "RUNHAN YU",
    "logo": {
      "@type": "ImageObject",
      "url": "/img/icon-512.png"
    }
  },
  "description": "This is my implementaion on the Django tutorial.\nCreate Django project and a polls app First, I verify my Django installation and version by:\npython -m django --version  If Python (use 3 here) or Django (1.11.23 here) is not installed, go by:\nbrew install python mkdir ~/.venvs/venv python3 -m venv ~/.venvs/venv source ~/.venvs/venv/bin/activate pip install django==1.11.23 pip install psycopg2  Now I could create a project with a collection of settings for an instance of Django."
}
</script>

  

  


  


  





  <title>My first Django app | RUNHAN YU</title>

</head>

<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" >

  <aside class="search-results" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search">
        
      </div>

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>


  
<nav class="navbar navbar-light fixed-top navbar-expand-lg py-0 compensate-for-scrollbar" id="navbar-main">
  <div class="container">

    
      <a class="navbar-brand" href="/">RUNHAN YU</a>
      
      <button type="button" class="navbar-toggler" data-toggle="collapse"
              data-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
        <span><i class="fas fa-bars"></i></span>
      </button>
      

    
    <div class="collapse navbar-collapse" id="navbar">

      
      
      <ul class="navbar-nav mr-auto">
        

        

        
        
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link  active" href="/"><span>Home</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link  active" href="/post"><span>Posts</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link " href="/project"><span>Projects</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link " href="/publication"><span>Publications</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link " href="/tags"><span>Tag</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link " href="/files/Runhan-Yu-SDE.pdf"><span>CV</span></a>
        </li>

        
        

      
      </ul>
      <ul class="navbar-nav ml-auto">
      

        

        
        <li class="nav-item">
          <a class="nav-link js-search" href="#"><i class="fas fa-search" aria-hidden="true"></i></a>
        </li>
        

        

        
        <li class="nav-item">
          <a class="nav-link js-dark-toggle" href="#"><i class="fas fa-moon" aria-hidden="true"></i></a>
        </li>
        

      </ul>

    </div>
  </div>
</nav>


  <article class="article">

  












  

  
  
  
<div class="article-container pt-3">
  <h1>My first Django app</h1>

  

  
    



<div class="article-metadata">

  
  

  
  <span class="article-date">
    
    
      
          Last updated on
      
    
    Nov 5, 2019
  </span>
  

  

  
  <span class="middot-divider"></span>
  <span class="article-reading-time">
    14 min read
  </span>
  

  
  
  

  
  

  
    
<div class="share-box" aria-hidden="true">
  <ul class="share">
    
      
      
      
        
      
      
      
      <li>
        <a href="https://twitter.com/intent/tweet?url=/post/451.html/&amp;text=My%20first%20Django%20app" target="_blank" rel="noopener" class="share-btn-twitter">
          <i class="fab fa-twitter"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.facebook.com/sharer.php?u=/post/451.html/&amp;t=My%20first%20Django%20app" target="_blank" rel="noopener" class="share-btn-facebook">
          <i class="fab fa-facebook-f"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="mailto:?subject=My%20first%20Django%20app&amp;body=/post/451.html/" target="_blank" rel="noopener" class="share-btn-email">
          <i class="fas fa-envelope"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.linkedin.com/shareArticle?url=/post/451.html/&amp;title=My%20first%20Django%20app" target="_blank" rel="noopener" class="share-btn-linkedin">
          <i class="fab fa-linkedin-in"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://web.whatsapp.com/send?text=My%20first%20Django%20app%20/post/451.html/" target="_blank" rel="noopener" class="share-btn-whatsapp">
          <i class="fab fa-whatsapp"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://service.weibo.com/share/share.php?url=/post/451.html/&amp;title=My%20first%20Django%20app" target="_blank" rel="noopener" class="share-btn-weibo">
          <i class="fab fa-weibo"></i>
        </a>
      </li>
    
  </ul>
</div>


  

</div>

    














  
</div>



  <div class="article-container">

    <div class="article-style">
      

<p>This is my implementaion on the <a href="https://docs.djangoproject.com/en/1.11/intro/tutorial01/" target="_blank">Django tutorial</a>.</p>

<h2 id="create-django-project-and-a-polls-app">Create Django project and a <code>polls</code> app</h2>

<p>First, I verify my Django installation and version by:</p>

<pre><code class="language-sh">python -m django --version
</code></pre>

<p>If Python (use 3 here) or Django (1.11.23 here) is not installed, go by:</p>

<pre><code class="language-sh">brew install python
mkdir ~/.venvs/venv
python3 -m venv ~/.venvs/venv
source ~/.venvs/venv/bin/activate
pip install django==1.11.23
pip install psycopg2
</code></pre>

<p>Now I could create a project with a collection of settings for an instance of Django. Avoid naming projects after built-in Python (<code>test</code>) or Django (<code>django</code>) components. And for security, put codes in some directory outside of the document root, such as <code>/home/mycode</code>.</p>

<pre><code class="language-sh">django-admin startproject mysite
</code></pre>

<p>And this creates:</p>

<pre><code class="language-text">mysite
├── manage.py # a command-line utility
└── mysite # actual Python package for mysite project
    ├── __init__.py
    ├── settings.py # settings/configuration
    ├── urls.py # URL declaration; a 'table of contents' of the Django-powered site
    └── wsgi.py # entry-point for WSGI-compatible web servers to serve the project
</code></pre>

<p>I could run and verify the function of the development server (default port is 8000)</p>

<pre><code class="language-sh">python manage.py runserver 8001
</code></pre>

<p>The development server automatically reloads Python code for each request as needed.</p>

<p>Now I have a project (a collection of configuration), I want to create some apps for the website right next to my <code>manage.py</code> as a top-level module. So I create the Polls app by:</p>

<pre><code class="language-sh">python manage.py startapp polls
</code></pre>

<p>And this creates:</p>

<pre><code class="language-text">polls
├── __init__.py
├── admin.py
├── apps.py
├── migrations
│   └── __init__.py
├── models.py
├── tests.py
└── views.py
</code></pre>

<h2 id="write-my-first-view-for-the-polls-app">Write my first <code>view</code> for the <code>polls</code> app</h2>

<p>Edit <code>polls/views.py</code> as:</p>

<pre><code class="language-python">from django.shortcuts import render
from django.http import HttpResponse

def index(request):
    return HttpResponse(&quot;Hello, world. You're at the polls index.&quot;)
</code></pre>

<p>Map the view it to a URL by URLconf <code>polls/urls.py</code>:</p>

<p><a id="code-snippet--polls-urls.py"></a></p>

<pre><code class="language-python">from django.conf.urls import url

from . import views

urlpatterns = [
    url(r'^$', views.index, name='index'),
]
</code></pre>

<p>And point the root URLconf at the <code>polls.urls</code> module by editing <code>mysite/urls.py</code>:</p>

<p><a id="code-snippet--mysite-urls.py"></a></p>

<pre><code class="language-python">from django.conf.urls import url, include
from django.contrib import admin

urlpatterns = [
    url(r'^polls/', include('polls.urls')),
    url(r'^admin/', admin.site.urls),
]
</code></pre>

<p>The <code>include()</code> function allows referencing other URLconfs. You should always use <code>include()</code> when you include other URL patterns. <code>admin.site.urls</code> is the only exception to this.</p>

<p>The <code>url(regex, view, [kwargs, name])</code> function is passed four arguments.
Note that the <code>regex</code> does not search GET and POST parameters, or the domain name.</p>

<h2 id="setup-database-for-django-apps">Setup database for Django apps</h2>

<p>Prepare PostgreSQL database:</p>

<pre><code class="language-sh">brew install postgresql@10
brew link postgresql@10 --force
brew services start postgresql@10
createuser --superuser djangouser
createdb -O djangouser djangodb
psql djangodb; ALTER USER djangouser PASSWORD 'mypassword';
</code></pre>

<p>Setup database in <code>mysite/settings.py</code>:</p>

<p><a id="code-snippet--mysite-settings.py"></a></p>

<pre><code class="language-python">DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.postgresql',
        'NAME': 'djangodb',
        'USER': 'djangouser',
        'PASSWORD': 'mypassword',
        'HOST': '127.0.0.1',
        'PORT': '5432'
    }
}
</code></pre>

<p>Then run <code>migrate</code> command to create the tables for <code>INSTALLED_APPS</code> in the database, currently for <code>admin</code>, <code>auth</code>, <code>contenttypes</code> and <code>sessions</code>:</p>

<pre><code class="language-sh">python manage.py migrate
</code></pre>

<h2 id="create-models-for-the-polls-app">Create Models for the <code>polls</code> app</h2>

<h3 id="change-models-in-models-dot-py">Change models in <code>models.py</code></h3>

<p>Now I will define my models, essentially my database layout with additional metadata. Note Django follows the DRY (Don&rsquo;t Repeat Yourself, every piece of knowledge must have a single, unambiguous, authoritative representation within a system) principle.</p>

<p>I create two models <code>Questions</code> and <code>Choice</code> in my simple poll app:</p>

<p><a id="code-snippet--polls-models.py"></a></p>

<pre><code class="language-python">from django.db import models
from django.utils.encoding import python_2_unicode_compatible

@python_2_unicode_compatible # support Python 2
class Question(models.Model):
    question_text = models.CharField(max_length=200) # field
    pub_date = models.DateTimeField('date published')

    # it is important to add object representation
    # especially for Django's automatically-generated admin
    def __str__(self):
        return self.question_text

    # custom method for demonstration
    def was_published_recently(self):
        now = timezone.now()
        return now - datetime.timedelta(days=1) &lt;= self.pub_date &lt;= now

    # custom the question change list in admin view
    was_published_recently.admin_order_field = 'pub_date'
    was_published_recently.boolean = True # use icon to represent true or false
    was_published_recently.short_description = 'Published recently?'

class Choice(models.Model):
    question = models.ForeignKey(Question, on_delete=models.CASCADE) # relationship
    choice_text = models.CharField(max_length=200)
    votes = models.IntegerField(default=0)
    def __str__(self):
        return self.choice_text
</code></pre>

<p>Then I could add a reference of <code>polls</code> app to its configuration class in the <code>INSTALLED_APPS</code> setting.</p>

<p><a id="code-snippet--mysite-settings.py"></a></p>

<pre><code class="language-python">INSTALLED_APPS = [
    'polls.apps.PollsConfig',
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
]
</code></pre>

<h3 id="run-python-manage-dot-py-makemigrations-to-create-migrations-for-those-changes">Run <code>python manage.py makemigrations</code> to create migrations for those changes</h3>

<p>Now run the command to tell Django that I would like store the changes for <code>polls</code> as a <em>migration</em>:</p>

<pre><code class="language-sh">python manage.py makemigrations polls
</code></pre>

<p>I could also see the SQL that migration would run by:</p>

<pre><code class="language-sh">python manage.py sqlmigrate polls 0001
</code></pre>

<pre><code class="language-sql">BEGIN;
--
-- Create model Choice
--
CREATE TABLE &quot;polls_choice&quot; (&quot;id&quot; serial NOT NULL PRIMARY KEY, &quot;choice_text&quot; varchar(200
) NOT NULL, &quot;votes&quot; integer NOT NULL);
--
-- Create model Question
--
CREATE TABLE &quot;polls_question&quot; (&quot;id&quot; serial NOT NULL PRIMARY KEY, &quot;question_text&quot; varchar
(200) NOT NULL, &quot;pub_date&quot; timestamp with time zone NOT NULL);
--
-- Add field question to choice
--
ALTER TABLE &quot;polls_choice&quot; ADD COLUMN &quot;question_id&quot; integer NOT NULL;
CREATE INDEX &quot;polls_choice_question_id_c5b4b260&quot; ON &quot;polls_choice&quot; (&quot;question_id&quot;);
ALTER TABLE &quot;polls_choice&quot; ADD CONSTRAINT &quot;polls_choice_question_id_c5b4b260_fk_polls_qu
estion_id&quot; FOREIGN KEY (&quot;question_id&quot;) REFERENCES &quot;polls_question&quot; (&quot;id&quot;) DEFERRABLE INI
TIALLY DEFERRED;
COMMIT;
</code></pre>

<h3 id="run-python-manage-dot-py-migrate-to-apply-those-changes-to-the-database">Run <code>python manage.py migrate</code> to apply those changes to the database</h3>

<p>Then I create those model tables in my database by running <code>migrate</code> again:</p>

<pre><code class="language-sh">python manage.py migrate
</code></pre>

<h2 id="use-django-apis-to-interact-with-the-polls-app">Use Django APIs to interact with the <code>polls</code> app</h2>

<p>Now I could play with the Django API using the Python shell under <code>DJANGO_SETTINGS_MODULE environment variable</code>:</p>

<pre><code class="language-sh">$ python manage.py shell
&gt;&gt;&gt; from polls.models import Question, Choice
&gt;&gt;&gt; Question.objects.all()
&gt;&gt;&gt; from django.utils import timezone
&gt;&gt;&gt; q = Question(question_text=&quot;What's new?&quot;, pub_date=timezone.now())
&gt;&gt;&gt; q.save()
&gt;&gt;&gt; q.id
&gt;&gt;&gt; q.question_text
&gt;&gt;&gt; q.pub_date
&gt;&gt;&gt; Question.objects.get(pub_date__year=timezone.now().year)
&gt;&gt;&gt; Question.objects.get(id=1) # identical to Question.objects.get(pk=1)
&gt;&gt;&gt; q.was_published_recently()
</code></pre>

<h2 id="use-django-admin-to-manage-the-question-object">Use Django Admin to manage the <code>Question</code> object</h2>

<p>Django was written in a newsroom environment. The admin is intended to be used for site managers to edit content.</p>

<p>An admin could be created by:</p>

<pre><code class="language-sh">python manage.py createsuperuser
</code></pre>

<p>Then I could login through <a href="http://127.0.0.1:8001/admin/" target="_blank">http://127.0.0.1:8001/admin/</a></p>

<p>Don&rsquo;t forget to register the Question object with an admin interface by:</p>

<p><a id="code-snippet--polls-admin.py"></a></p>

<pre><code class="language-python">from django.contrib import admin
from .models import Question

admin.site.register(Question)
</code></pre>

<h2 id="four-public-interface-views-for-the-polls-app">Four public interface <code>views</code> for the <code>polls</code> app</h2>

<p>I will create four views for the <code>polls</code> app:</p>

<ul>
<li>Question &ldquo;index&rdquo; page: displays the latest few questions.</li>
<li>Question &ldquo;detail&rdquo; page: displays a question text, with no results but with a form to vote.</li>
<li>Question &ldquo;results&rdquo; page: displays results for a particular question.</li>
<li>Vote action: handles voting for a particular choice in a particular question.</li>
</ul>

<!--listend-->

<p><a id="code-snippet--polls-views.py"></a></p>

<pre><code class="language-python">from django.shortcuts import render
from django.http import HttpResponse

def index(request):
    return HttpResponse(&quot;Hello, world. You're at the polls index.&quot;)

def detail(request, question_id):
    return HttpResponse(&quot;You're looking at question %s.&quot; % question_id)

def results(request, question_id):
    return HttpResponse(response % question_id)

def vote(request, question_id):
    return HttpResponse(&quot;You're voting on question %s.&quot; % question_id)
</code></pre>

<p><a id="code-snippet--polls-urls.py"></a></p>

<pre><code class="language-python">from django.conf.urls import url

from . import views

app_name = 'polls'
urlpatterns = [
    # e.g. /polls/
    url(r'^$', views.index, name='index'),
    # e.g. /polls/5/
    url(r'^(?P&lt;question_id&gt;[0-9]+)/$', views.detail, name='detail'),
    # e.g. /polls/5/results/
    url(r'^(?P&lt;question_id&gt;[0-9]+)/results/$', views.results, name='results'),
    # e.g. /polls/5/vote/
    url(r'^(?P&lt;question_id&gt;[0-9]+)/vote/$', views.vote, name='vote'),
]
</code></pre>

<h3 id="index-view">Index view</h3>

<p>I could use <code>templates</code> directory to seperate design from Python:</p>

<p><a id="code-snippet--polls-templates-polls-index.html"></a></p>

<pre><code class="language-html">{% if latest_question_list %}
    &lt;ul&gt;
    {% for question in latest_question_list %}
        &lt;li&gt;&lt;a href=&quot;{% url 'polls:detail' question.id %}&quot;&gt;{{ question.question_text }}&lt;/a&gt;&lt;/li&gt;
    {% endfor %}
    &lt;/ul&gt;
{% else %}
    &lt;p&gt;No polls are available.&lt;/p&gt;
{% endif %}
</code></pre>

<p>Here I use <code>&lt;a href=&quot;{% url 'polls:detail' question.id %}&quot;&gt;</code> to avoid hardcoded link like <code>&lt;a href=&quot;/polls/{{ question.id }}/&quot;&gt;</code>, so that it look up the URL definition as specified in the <code>polls.url</code> module. I use <code>polls:detail</code> here to point at the namespaced detail view, as <code>'polls'</code> is specified as <code>app_name</code> in <code>polls/urls.py</code>.</p>

<p><a id="code-snippet--polls-views.py"></a></p>

<pre><code class="language-python"># ...
from django.utils import timezone
from .models import Question

def index(request):
    latest_question_list = Question.objects.filter(
        pub_date__lte=timezone.now()
    ).order_by('-pub_date')[:5]
    context = {'latest_question_list': latest_question_list}
    return render(request, 'polls/index.html', context)
# ...
</code></pre>

<p>Here I use <code>render()</code> shortcut for <code>HttpResponse(loader.get_template(file).render(context, request))</code>.</p>

<h3 id="detail-view-or-raise-a-404-error">Detail view or raise a 404 error</h3>

<p>Each view is responsible for doing one of two things: returning an <code>HttpResponse</code> object containing the content for the requested page, or raising an exception such as <code>Http404</code>.</p>

<p><a id="code-snippet--polls-templates-polls-detail.html"></a></p>

<pre><code class="language-html">&lt;h1&gt;{{ question.question_text }}&lt;/h1&gt;
&lt;ul&gt;
{% for choice in question.choice_set.all %}
    &lt;li&gt;{{ choice.choice_text }}&lt;/li&gt;
{% endfor %}
&lt;/ul&gt;
</code></pre>

<p><a id="code-snippet--polls-views.py"></a></p>

<pre><code class="language-python">from django.shortcuts import get_object_or_404, render
from .models import Question
# ...
def detail(request, question_id):
    question = get_object_or_404(
        Question.objects.filter(pub_date__lte=timezone.now()), pk=question_id
    )
    return render(request, 'polls/detail.html', {'question': question})
# ...
</code></pre>

<p>Here I use <code>get_object_or_404()</code> shortcut for <code>Http404</code> exception.</p>

<h3 id="vote-view-creating-a-simple-form">Vote view: creating a simple form</h3>

<p>Now I update my poll detail template and add a simple form to it.</p>

<p><a id="code-snippet--polls-templates-polls-detail.html"></a></p>

<pre><code class="language-html">&lt;h1&gt;{{ question.question_text }}&lt;/h1&gt;

{% if error_message %}&lt;p&gt;&lt;strong&gt;{{ error_message }}&lt;/strong&gt;&lt;/p&gt;{% endif %}

&lt;!--POST, act of submitting form will alter data server-side--&gt;
&lt;form action=&quot;{% url 'polls:vote' question.id %}&quot; method=&quot;post&quot;&gt;
  &lt;!--this protect from Cross Site Request Forgeries--&gt;
  {% csrf_token %}
  {% for choice in question.choice_set.all %}
  &lt;!--display a radio button which POST data choice=choice.id--&gt;
  &lt;input type=&quot;radio&quot; name=&quot;choice&quot; id=&quot;choice{{ forloop.counter }}&quot; value=&quot;{{ choice.id }}&quot; /&gt;
  &lt;label for=&quot;choice{{ forloop.counter }}&quot;&gt;{{ choice.choice_text }}&lt;/label&gt;&lt;br /&gt;
  {% endfor %}
  &lt;input type=&quot;submit&quot; value=&quot;Vote&quot; /&gt;
&lt;/form&gt;
</code></pre>

<p>Note all POST forms that are targeted at internal URLs should use the <code>{% csrf_token %}</code> template tag to protect from Cross Site Request Forgeries.</p>

<p>And I also replace the dummy implementation of the <code>vote()</code> function with a real one.</p>

<p><a id="code-snippet--polls-views.py"></a></p>

<pre><code class="language-python">from django.shortcuts import get_object_or_404, render
from django.http import HttpResponseRedirect, HttpResponse
from django.urls import reverse

from .models import Choice, Question
# ...
def vote(request, question_id):
    question = get_object_or_404(Question, pk=question_id)
    try:
        selected_choice = question.choice_set.get(pk=request.POST['choice'])
    except (KeyError, Choice.DoesNotExist):
        # Redisplay the question voting form.
        return render(request, 'polls/detail.html', {
            'question': question,
            'error_message': &quot;You didn't select a choice.&quot;,
        })
    else:
        selected_choice.votes += 1
        selected_choice.save()
        # Always return an HttpResponseRedirect after successfully dealing
        # with POST data. This prevents data from being posted twice if a
        # user hits the Back button.
        return HttpResponseRedirect(reverse('polls:results', args=(question.id,)))
</code></pre>

<p>Note that always return an HttpResponseRedirect after successfully dealing with POST data to prevent from posting data twice if a user hits the Back button. And I use the <code>reverse()</code> function in the <code>HttpResponseRedirect</code> constructor to help avoid hardcoding a URL in the view function.</p>

<p>And note that this <code>vote()</code> have a <em>race condition</em> problem: if two users of my website try to vote at <em>exactly the same time</em>, the computed new value of <code>votes</code> might go wrong.</p>

<h3 id="result-view">Result view</h3>

<p>Now I implement the <code>result()</code> view by creating a result template and update the view.</p>

<p><a id="code-snippet--polls-templates-polls-results.html"></a></p>

<pre><code class="language-html">&lt;h1&gt;{{ question.question_text }}&lt;/h1&gt;

&lt;ul&gt;
  {% for choice in question.choice_set.all %}
  &lt;li&gt;{{ choice.choice_text }} -- {{ choice.votes }} vote{{ choice.votes|pluralize }}&lt;/li&gt;
  {% endfor %}
&lt;/ul&gt;

&lt;a href=&quot;{% url 'polls:detail' question.id %}&quot;&gt;Vote again?&lt;/a&gt;
</code></pre>

<p><a id="code-snippet--polls-view.py"></a></p>

<pre><code class="language-python"># ...
def results(request, question_id):
    question = get_object_or_404(
        Question.objects.filter(pub_date__lte=timezone.now), pk=question_id
    )
    return render(request, 'polls/results.html', {'question': question})
# ...
</code></pre>

<h2 id="use-django-s-generic-views-instead-for-some-simple-views-in-the-polls-app">Use Django&rsquo;s generic views instead for some simple views in the <code>polls</code> app</h2>

<p>Since it is pretty common for basic Web development to get data from the database according a passing parameter in the URL, loading a template and returning template, Django provides generic views for the simple  <code>detail()</code>, <code>results()</code> and <code>index()</code> views.</p>

<p>In practice, when writing a Django app, people evaluate whether generic views are a good fit for their problem, and use them from the beginning.</p>

<p>I amend the <code>polls/urls.py</code> URLconf:</p>

<p><a id="code-snippet--polls-urls.py"></a></p>

<pre><code class="language-python">from django.conf.urls import url

from . import views

app_name = 'polls'
urlpatterns = [
    # e.g. /polls/
    url(r'^$', views.IndexView.as_view(), name='index'),
    # e.g. /polls/5/
    url(r'^(?P&lt;pk&gt;[0-9]+)/$', views.DetailView.as_view(), name='detail'),
    # e.g. /polls/5/results/
    url(r'^(?P&lt;pk&gt;[0-9]+)/results/$', views.ResultsView.as_view(), name='results'),
    # e.g. /polls/5/vote/
    url(r'^(?P&lt;question_id&gt;[0-9]+)/vote/$', views.vote, name='vote'),
]
</code></pre>

<p>Note <code>&lt;question_id&gt;</code> in second and third patterns changes to <code>&lt;pk&gt;</code>.</p>

<p>I also amend <code>index()</code>, <code>detail()</code> and <code>results()</code> views with Django&rsquo;s generic views:</p>

<p><a id="code-snippet--polls-view.py"></a></p>

<pre><code class="language-python">from django.shortcuts import get_object_or_404, render
from django.http import HttpResponseRedirect
from django.urls import reverse
from django.views import generic
from django.utils import timezone

from .models import Choice, Question


class IndexView(generic.ListView):
    template_name = 'polls/index.html'
    context_object_name = 'latest_question_list'

    def get_queryset(self):
        return Question.objects.filter(
            pub_date__lte=timezone.now()
        ).order_by('-pub_date')[:5]


class DetailView(generic.DetailView):
    model = Question
    template_name = 'polls/detail.html'

    def get_queryset(self):
        return Question.objects.filter(pub_date__lte=timezone.now())


class ResultsView(generic.DetailView):
    model = Question
    template_name = 'polls/results.html'

    def get_queryset(self):
        return Question.objects.filter(pub_date__lte=timezone.now())

# ...
</code></pre>

<h2 id="automated-testing">Automated testing</h2>

<p>I will create some automated tests so that as I make changes to my app, I could check that my code still works well. Besides,</p>

<ul>
<li>Tests will save time</li>
<li>Tests don&rsquo;t just identify problems, they prevent them</li>
<li>Tests make my code more attractive</li>
<li>Tests help teams work together</li>
</ul>

<p>Rules of thumb:</p>

<ul>
<li>a separate TestClass for each model or view</li>
<li>a separate test method for each set of conditions you want to test</li>
<li>test method names that describe their function</li>
</ul>

<p>Here is some tests to check if the <code>polls</code> app not deals with future questions.</p>

<p><a id="code-snippet--polls-tests.py"></a></p>

<pre><code class="language-python">import datetime

from django.utils import timezone
from django.test import TestCase
from django.urls import reverse

from .models import Question


class QuestionModelTests(TestCase):

    def test_was_published_recently_with_future_question(self):
        &quot;&quot;&quot;
        was_published_recently() returns False for questions whose pub_date
        is in the future.
        &quot;&quot;&quot;
        time = timezone.now() + datetime.timedelta(days=30)
        future_question = Question(pub_date=time)
        self.assertIs(future_question.was_published_recently(), False)

    def test_was_published_recently_with_old_question(self):
        &quot;&quot;&quot;
        was_published_recently() returns False for questions whose pub_date
        is older than 1 day.
        &quot;&quot;&quot;
        time = timezone.now() - datetime.timedelta(days=1, seconds=1)
        old_question = Question(pub_date=time)
        self.assertIs(old_question.was_published_recently(), False)

    def test_was_published_recently_with_recent_question(self):
        &quot;&quot;&quot;
        was_published_recently() returns True for questions whose pub_date
        is within the last day.
        &quot;&quot;&quot;
        time = timezone.now() - datetime.timedelta(hours=23, minutes=59, seconds=59)
        recent_question = Question(pub_date=time)
        self.assertIs(recent_question.was_published_recently(), True)


def create_question(question_text, days):
    &quot;&quot;&quot;
    Create a question with the given `question_text` and published the
    given number of `days` offset to now (negative for questions published
    in the past, positive for questions that have yet to be published).
    &quot;&quot;&quot;
    time = timezone.now() + datetime.timedelta(days=days)
    return Question.objects.create(question_text=question_text, pub_date=time)


class QuestionIndexViewTests(TestCase):
    def test_no_questions(self):
        &quot;&quot;&quot;
        If no questions exist, an appropriate message is displayed.
        &quot;&quot;&quot;
        response = self.client.get(reverse('polls:index'))
        self.assertEqual(response.status_code, 200)
        self.assertContains(response, &quot;No polls are available.&quot;)
        self.assertQuerysetEqual(response.context['latest_question_list'], [])

    def test_past_question(self):
        &quot;&quot;&quot;
        Questions with a pub_date in the past are displayed on the
        index page.
        &quot;&quot;&quot;
        create_question(question_text=&quot;Past question.&quot;, days=-30)
        response = self.client.get(reverse('polls:index'))
        self.assertQuerysetEqual(
            response.context['latest_question_list'],
            ['&lt;Question: Past question.&gt;']
        )

    def test_future_question(self):
        &quot;&quot;&quot;
        Questions with a pub_date in the future aren't displayed on
        the index page.
        &quot;&quot;&quot;
        create_question(question_text=&quot;Future question.&quot;, days=30)
        response = self.client.get(reverse('polls:index'))
        self.assertContains(response, &quot;No polls are available.&quot;)
        self.assertQuerysetEqual(response.context['latest_question_list'], [])

    def test_future_question_and_past_question(self):
        &quot;&quot;&quot;
        Even if both past and future questions exist, only past questions
        are displayed.
        &quot;&quot;&quot;
        create_question(question_text=&quot;Past question.&quot;, days=-30)
        create_question(question_text=&quot;Future question.&quot;, days=30)
        response = self.client.get(reverse('polls:index'))
        self.assertQuerysetEqual(
            response.context['latest_question_list'],
            ['&lt;Question: Past question.&gt;']
        )

    def test_two_past_questions(self):
        &quot;&quot;&quot;
        The questions index page may display multiple questions.
        &quot;&quot;&quot;
        create_question(question_text=&quot;Past question 1.&quot;, days=-30)
        create_question(question_text=&quot;Past question 2.&quot;, days=-5)
        response = self.client.get(reverse('polls:index'))
        self.assertQuerysetEqual(
            response.context['latest_question_list'],
            ['&lt;Question: Past question 2.&gt;', '&lt;Question: Past question 1.&gt;']
        )


class QuestionDetailViewTests(TestCase):
    def test_future_question(self):
        &quot;&quot;&quot;
        The detail view of a question with a pub_date in the future
        returns a 404 not found.
        &quot;&quot;&quot;
        future_question = create_question(question_text='Future question.', days=5)
        url = reverse('polls:detail', args=(future_question.id,))
        response = self.client.get(url)
        self.assertEqual(response.status_code, 404)

    def test_past_question(self):
        &quot;&quot;&quot;
        The detail view of a question with a pub_date in the past
        displays the question's text.
        &quot;&quot;&quot;
        past_question = create_question(question_text='Past Question.', days=-5)
        url = reverse('polls:detail', args=(past_question.id,))
        response = self.client.get(url)
        self.assertContains(response, past_question.question_text)
</code></pre>

<h2 id="customize-the-polls-app-s-look-and-feel">Customize the <code>polls</code> app&rsquo;s look and feel</h2>

<p>Django will look for statis files in the <code>polls/static/</code> directory. Its <code>STATICFILES_FINDERS</code> setting contains a list of finders that know how to discover static files from various source. <code>AppDirectoriesFinder</code> staticfile finder finds the stylesheet at <code>polls/static/polls/style.css</code>.</p>

<p><a id="code-snippet--polls-static-polls-style.css"></a></p>

<pre><code class="language-css">li a {
    color: green;
}

body {
    background: white url(&quot;images/background.gif&quot;) no-repeat right bottom;
}
</code></pre>

<p>And I add the <code>{% static %}</code> template tag at the top of <code>polls/templates/polls/index.html</code>.</p>

<p><a id="code-snippet--polls-templates-polls-index.html"></a></p>

<pre><code class="language-html">{% load static %}

&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;{% static 'polls/style.css' %}&quot;&gt;
</code></pre>

<p>Note always use relative paths to link static files between each other.</p>

<h2 id="customize-the-admin-site">Customize the admin site</h2>

<p>I customize the admin form by editing <code>polls/admin.py</code>:</p>

<p><a id="code-snippet--polls-admin.py"></a></p>

<pre><code class="language-python">from django.contrib import admin

from .models import Choice, Question


class ChoiceInline(admin.TabularInline):
    model = Choice
    extra = 3


class QuestionAdmin(admin.ModelAdmin):
    fieldsets = [
        (None, {'fields': ['question_text']}),
        ('Date information', {'fields': ['pub_date'], 'classes': ['collapse']}),
    ]
    inlines = [ChoiceInline]
    list_display = ('question_text', 'pub_date', 'was_published_recently')
    list_filter = ['pub_date']
    search_fields = ['question_text']

admin.site.register(Question, QuestionAdmin)
</code></pre>

<p>I use <code>fieldsets</code> to split the form up and provide an usability detail. Alternatively, <code>fields</code> could be directly used here serving only a few fields.</p>

<p>For <code>ChoiceInline</code>, with <code>TabularInline</code>, the related objects are displayed in a compact, table-based format. I could also spread it out using <code>StackInline</code>.</p>

<p>I can also customize the Django admin itself. First I add a <code>DIRS</code> option in the <code>TEMPLATES</code> setting in the setting files:</p>

<p><a id="code-snippet--mysite-setting.py"></a></p>

<pre><code class="language-python">TEMPLATES = [
    {
        # ...
        'DIRS': [os.path.join(BASE_DIR, 'templates')],
        # ...
    },
]
</code></pre>

<p>Find the Django source file, and copy the <code>django/contrib/admin/templates/admin/base_site.html</code> into <code>templates/admin/</code>:</p>

<pre><code class="language-sh">python -c &quot;import django; print(django.__path__)&quot;
mkdir templates/admin
cp PATH/django/contrib/admin/templates/admin/base_site.html templates/admin/base_site.html
</code></pre>

<p>Edit as:</p>

<p><a id="code-snippet--templates-admin-base-site.html"></a></p>

<pre><code class="language-html">{% extends &quot;admin/base.html&quot; %}

{% block title %}{{ title }} | {{ site_title|default:_('Django site admin') }}{% endblock %}

{% block branding %}
&lt;h1 id=&quot;site-name&quot;&gt;&lt;a href=&quot;{% url 'admin:index' %}&quot;&gt;Polls Administration&lt;/a&gt;&lt;/h1&gt;
{% endblock %}

{% block nav-global %}{% endblock %}
</code></pre>

<h2 id="wrap-up">Wrap up</h2>

<p>Now my Django app looks like this:</p>

<pre><code class="language-text">mysite
├── db.sqlite3
├── manage.py
├── mysite
│   ├── __init__.py
│   ├── settings.py
│   ├── urls.py
│   └── wsgi.py
├── polls
│   ├── __init__.py
│   ├── admin.py
│   ├── apps.py
│   ├── migrations
│   │   ├── 0001_initial.py
│   │   ├── __init__.py
│   ├── models.py
│   ├── static
│   │   └── polls
│   │       ├── images
│   │       │   └── background.gif
│   │       └── style.css
│   ├── templates
│   │   └── polls
│   │       ├── detail.html
│   │       ├── index.html
│   │       └── results.html
│   ├── tests.py
│   ├── urls.py
│   └── views.py
└── templates
    └── admin
        └── base_site.html
</code></pre>

<p>It is also useful to turn the <code>polls</code> app into a standalone Python package, but it is another story.</p>

    </div>

    


    

<div class="article-tags">
  
  <a class="badge badge-light" href="/tags/python/">Python</a>
  
  <a class="badge badge-light" href="/tags/django/">Django</a>
  
</div>



    
      








  






  
  
  
    
  
  
  <div class="media author-card">
    
      
      <img class="portrait mr-3" src="/authors/admin/avatar_hu8d2ecfec5daac15b322d8551e4669aa2_8959_250x250_fill_q90_lanczos_center.jpeg" alt="Avatar">
    

    <div class="media-body">
      <h5 class="card-title"><a href="/">Runhan Yu</a></h5>
      <h6 class="card-subtitle">Data Engineer</h6>
      <p class="card-text">My interests include software development, big data, cloud computing and biochemistry.</p>
      <ul class="network-icon" aria-hidden="true">
        
          
          
          
            
          
          
          
          
          
            
          
          <li>
            <a href="https://github.com/ziyunch" target="_blank" rel="noopener">
              <i class="fab fa-github"></i>
            </a>
          </li>
        
          
          
          
            
          
          
          
          
          
            
          
          <li>
            <a href="https://www.linkedin.com/in/runhanyu/" target="_blank" rel="noopener">
              <i class="fab fa-linkedin"></i>
            </a>
          </li>
        
          
          
          
            
          
          
          
          
          
            
          
          <li>
            <a href="/#contact" >
              <i class="fas fa-envelope"></i>
            </a>
          </li>
        
          
          
          
          
          
          
          
            
          
          <li>
            <a href="https://scholar.google.com/citations?user=iuNw-9YAAAAJ" target="_blank" rel="noopener">
              <i class="ai ai-google-scholar"></i>
            </a>
          </li>
        
          
          
          
          
          
          
          
            
          
          <li>
            <a href="/files/Runhan-Yu-SDE.pdf" >
              <i class="ai ai-cv"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>



      
      
      <div class="article-widget">
        <div class="hr-light"></div>
        <h3>Related</h3>
        <ul>
          
          <li><a href="/post/448.html/">Hacking the Data Transformation Interview</a></li>
          
          <li><a href="/post/444.html/">Plain text accounting tool Beancount in Emacs</a></li>
          
          <li><a href="/project/gistic/">Gene Variation Analysis of Stomach Cancer</a></li>
          
          <li><a href="/project/csv2bean/">CSV2Bean</a></li>
          
          <li><a href="/project/rxminer/">RxMiner</a></li>
          
        </ul>
      </div>
      
    

    

    


  </div>
</article>

      

    
    

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.js" integrity="sha256-X5PoE3KU5l+JcX+w09p/wHl9AzK333C4hJ2I9S5mD4M=" crossorigin="anonymous"></script>

      

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/highlight.min.js" integrity="sha256-aYTdUrn6Ow1DDgh5JTc3aDGnnju48y/1c8s1dgkYPQ8=" crossorigin="anonymous"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/languages/r.min.js"></script>
        
      

      
      
    

    
    

    
    
    <script>hljs.initHighlightingOnLoad();</script>
    

    
    
    <script>
      const search_index_filename = "/index.json";
      const i18n = {
        'placeholder': "Search...",
        'results': "results found",
        'no_results': "No results found"
      };
      const content_type = {
        'post': "Posts",
        'project': "Projects",
        'publication' : "Publications",
        'talk' : "Talks"
        };
    </script>
    

    
    

    
    
    <script id="search-hit-fuse-template" type="text/x-template">
      <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
      </div>
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>
    

    
    

    
    

    
    
    
    
    
    
    
    
    
      
    
    
    
    
    <script src="/js/academic.min.130521ecfc6f534c52c158217bbff718.js"></script>

    






  
  <div class="container">
    <footer class="site-footer">
  

  <p class="powered-by">
    

    Powered by the
    <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
    <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.

    
    <span class="float-right" aria-hidden="true">
      <a href="#" id="back_to_top">
        <span class="button_icon">
          <i class="fas fa-chevron-up fa-2x"></i>
        </span>
      </a>
    </span>
    
  </p>
</footer>

  </div>
  

  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

</body>
</html>
