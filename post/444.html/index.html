<!DOCTYPE html>
<html lang="en-us">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Source Themes Academic 4.5.0">

  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="Runhan Yu">

  
  
  
    
  
  <meta name="description" content="昨天搞定 Emacs 的中文环境，今天想着好久没记帐了，随手记总是很花时间，干脆一鼓作气，将记帐一起搬过来。

复式记帐

我本科时双修了一门金融，其中最为繁琐，也是最令人头疼的一门课便是会计学。我不爱听讲，毕业之后也将会计的知识点忘得查差不多了，然而其&rdquo;有借必有贷，借贷必相等&rdquo;的复式记帐法，反而是我生活中运用最多的。

复式记帐法说起来复杂，对个人来说，就是将每笔交易分门别类，填入下面这条等式中：




  

资产 &#43; 费用 = 负债 &#43; 所有者权益 &#43; 收入



在个人记帐中，这条等式辅以借贷概念会令人望而生畏，所以我将其略一变形：




  

（&#43;资产）&#43;（-负债）&#43;（&#43;费用）&#43;（-收入）&#43;（-所有者权益）= 0




资产与负债都是与金钱直接挂钩的，比如银行户头，比如人民币美钞，比如信用卡帐户，再比如借条，这些都可以算是货币的不同表示形式。
费用与收入则是与金钱间接挂钩的，比如工资，比如商品，比如服务，这些都可以算是生产资本与商品资本的不同表现形式。其中收入与字面意思不同，可以理解为生产资本（劳动力等）。
所有者权益对个人意义不大，一般用来记录历史盈余与糊涂帐。


而这个变形公式中的正负号，则可以将各项目的符号关系，用作资金流向的参照。这么说有点玄乎，换个茨威格式的说法就是：&rdquo;人们从命运得到的一切，冥冥之中都记下了它的价钱。&rdquo;花钱买了服务，则是减少资产（花了钱），增加费用（得到服务）；工资到帐，则是增加资产（到帐），减少收入（既有劳动时间的减少）；别人跟你借了钱，则是资产减少（银行帐户或现金余额减少），负债增加（别人在你这儿的负债）。

总结一下，由于人类暂时无法操控时间，所以费用一般为正，收入一般为负。而没有破产的情况下资产一般为正，别人欠你的钱为正，信用卡债（你欠别人的钱）为负。">

  
  <link rel="alternate" hreflang="en-us" href="/post/444.html/">

  


  
  
  
  <meta name="theme-color" content="rgb(251, 191, 183)">
  

  
  
  
  
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.0/css/all.css" integrity="sha384-aOkxzJ5uQz7WBObEZcHvV5JvRW3TUc2rNPA7pe3AwnsUohiw1Vj2Rgx2KSOkF5+h" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.css" integrity="sha256-ygkqlh3CYSUri3LhQxzdcm0n1EQvH2Y+U5S2idbLtxs=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/github.min.css" crossorigin="anonymous" title="hl-light">
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/dracula.min.css" crossorigin="anonymous" title="hl-dark" disabled>
        
      
    

    

    

  

  
  
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro%7CLora:400,700%7CSource+Serif+Pro:400,700&display=swap">
  

  
  
  
  <link rel="stylesheet" href="/css/academic.min.cd1d04c8beda9bdca8f807d7f75dafdb.css">

  

  
  
  

  

  <link rel="manifest" href="/index.webmanifest">
  <link rel="icon" type="image/png" href="/img/icon-32.png">
  <link rel="apple-touch-icon" type="image/png" href="/img/icon-192.png">

  <link rel="canonical" href="/post/444.html/">

  
  
  
  
    
    
  
  
  <meta property="twitter:card" content="summary">
  
  <meta property="og:site_name" content="RUNHAN YU">
  <meta property="og:url" content="/post/444.html/">
  <meta property="og:title" content="Plain text accounting tool Beancount in Emacs | RUNHAN YU">
  <meta property="og:description" content="昨天搞定 Emacs 的中文环境，今天想着好久没记帐了，随手记总是很花时间，干脆一鼓作气，将记帐一起搬过来。

复式记帐

我本科时双修了一门金融，其中最为繁琐，也是最令人头疼的一门课便是会计学。我不爱听讲，毕业之后也将会计的知识点忘得查差不多了，然而其&rdquo;有借必有贷，借贷必相等&rdquo;的复式记帐法，反而是我生活中运用最多的。

复式记帐法说起来复杂，对个人来说，就是将每笔交易分门别类，填入下面这条等式中：




  

资产 &#43; 费用 = 负债 &#43; 所有者权益 &#43; 收入



在个人记帐中，这条等式辅以借贷概念会令人望而生畏，所以我将其略一变形：




  

（&#43;资产）&#43;（-负债）&#43;（&#43;费用）&#43;（-收入）&#43;（-所有者权益）= 0




资产与负债都是与金钱直接挂钩的，比如银行户头，比如人民币美钞，比如信用卡帐户，再比如借条，这些都可以算是货币的不同表示形式。
费用与收入则是与金钱间接挂钩的，比如工资，比如商品，比如服务，这些都可以算是生产资本与商品资本的不同表现形式。其中收入与字面意思不同，可以理解为生产资本（劳动力等）。
所有者权益对个人意义不大，一般用来记录历史盈余与糊涂帐。


而这个变形公式中的正负号，则可以将各项目的符号关系，用作资金流向的参照。这么说有点玄乎，换个茨威格式的说法就是：&rdquo;人们从命运得到的一切，冥冥之中都记下了它的价钱。&rdquo;花钱买了服务，则是减少资产（花了钱），增加费用（得到服务）；工资到帐，则是增加资产（到帐），减少收入（既有劳动时间的减少）；别人跟你借了钱，则是资产减少（银行帐户或现金余额减少），负债增加（别人在你这儿的负债）。

总结一下，由于人类暂时无法操控时间，所以费用一般为正，收入一般为负。而没有破产的情况下资产一般为正，别人欠你的钱为正，信用卡债（你欠别人的钱）为负。"><meta property="og:image" content="/img/icon-192.png">
  <meta property="twitter:image" content="/img/icon-192.png"><meta property="og:locale" content="en-us">
  
    
      <meta property="article:published_time" content="2019-07-04T12:58:00-04:00">
    
    <meta property="article:modified_time" content="2019-09-19T13:50:57-04:00">
  

  


    






  






<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "/post/444.html/"
  },
  "headline": "Plain text accounting tool Beancount in Emacs",
  
  "datePublished": "2019-07-04T12:58:00-04:00",
  "dateModified": "2019-09-19T13:50:57-04:00",
  
  "author": {
    "@type": "Person",
    "name": "Runhan Yu"
  },
  
  "publisher": {
    "@type": "Organization",
    "name": "RUNHAN YU",
    "logo": {
      "@type": "ImageObject",
      "url": "/img/icon-512.png"
    }
  },
  "description": "\u003cp\u003e昨天搞定 Emacs 的中文环境，今天想着好久没记帐了，随手记总是很花时间，干脆一鼓作气，将记帐一起搬过来。\u003c/p\u003e\n\n\u003ch2 id=\"复式记帐\"\u003e复式记帐\u003c/h2\u003e\n\n\u003cp\u003e我本科时双修了一门金融，其中最为繁琐，也是最令人头疼的一门课便是会计学。我不爱听讲，毕业之后也将会计的知识点忘得查差不多了，然而其\u0026rdquo;有借必有贷，借贷必相等\u0026rdquo;的复式记帐法，反而是我生活中运用最多的。\u003c/p\u003e\n\n\u003cp\u003e复式记帐法说起来复杂，对个人来说，就是将每笔交易分门别类，填入下面这条等式中：\u003c/p\u003e\n\n\u003cstyle\u003e.org-center { margin-left: auto; margin-right: auto; text-align: center; }\u003c/style\u003e\n\n\u003cdiv class=\"org-center\"\u003e\n  \u003cdiv\u003e\u003c/div\u003e\n\n\u003cp\u003e资产 + 费用 = 负债 + 所有者权益 + 收入\u003c/p\u003e\n\n\u003cp\u003e\u003c/div\u003e\u003c/p\u003e\n\n\u003cp\u003e在个人记帐中，这条等式辅以借贷概念会令人望而生畏，所以我将其略一变形：\u003c/p\u003e\n\n\u003cstyle\u003e.org-center { margin-left: auto; margin-right: auto; text-align: center; }\u003c/style\u003e\n\n\u003cdiv class=\"org-center\"\u003e\n  \u003cdiv\u003e\u003c/div\u003e\n\n\u003cp\u003e（+资产）+（-负债）+（+费用）+（-收入）+（-所有者权益）= 0\u003c/p\u003e\n\n\u003cp\u003e\u003c/div\u003e\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e资产与负债都是与金钱直接挂钩的，比如银行户头，比如人民币美钞，比如信用卡帐户，再比如借条，这些都可以算是货币的不同表示形式。\u003c/li\u003e\n\u003cli\u003e费用与收入则是与金钱间接挂钩的，比如工资，比如商品，比如服务，这些都可以算是生产资本与商品资本的不同表现形式。其中收入与字面意思不同，可以理解为生产资本（劳动力等）。\u003c/li\u003e\n\u003cli\u003e所有者权益对个人意义不大，一般用来记录历史盈余与糊涂帐。\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e而这个变形公式中的正负号，则可以将各项目的符号关系，用作资金流向的参照。这么说有点玄乎，换个茨威格式的说法就是：\u0026rdquo;人们从命运得到的一切，冥冥之中都记下了它的价钱。\u0026rdquo;花钱买了服务，则是减少资产（花了钱），增加费用（得到服务）；工资到帐，则是增加资产（到帐），减少收入（既有劳动时间的减少）；别人跟你借了钱，则是资产减少（银行帐户或现金余额减少），负债增加（别人在你这儿的负债）。\u003c/p\u003e\n\n\u003cp\u003e总结一下，由于人类暂时无法操控时间，所以费用一般为正，收入一般为负。而没有破产的情况下资产一般为正，别人欠你的钱为正，信用卡债（你欠别人的钱）为负。\u003c/p\u003e"
}
</script>

  

  


  


  





  <title>Plain text accounting tool Beancount in Emacs | RUNHAN YU</title>

</head>

<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" >

  <aside class="search-results" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search">
        
      </div>

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>


  
<nav class="navbar navbar-light fixed-top navbar-expand-lg py-0 compensate-for-scrollbar" id="navbar-main">
  <div class="container">

    
      <a class="navbar-brand" href="/">RUNHAN YU</a>
      
      <button type="button" class="navbar-toggler" data-toggle="collapse"
              data-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
        <span><i class="fas fa-bars"></i></span>
      </button>
      

    
    <div class="collapse navbar-collapse" id="navbar">

      
      
      <ul class="navbar-nav mr-auto">
        

        

        
        
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link  active" href="/"><span>Home</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link  active" href="/post"><span>Posts</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link " href="/project"><span>Projects</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link " href="/publication"><span>Publications</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link " href="/tags"><span>Tag</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link " href="/files/Runhan-Yu-SDE.pdf"><span>CV</span></a>
        </li>

        
        

      
      </ul>
      <ul class="navbar-nav ml-auto">
      

        

        
        <li class="nav-item">
          <a class="nav-link js-search" href="#"><i class="fas fa-search" aria-hidden="true"></i></a>
        </li>
        

        

        
        <li class="nav-item">
          <a class="nav-link js-dark-toggle" href="#"><i class="fas fa-moon" aria-hidden="true"></i></a>
        </li>
        

      </ul>

    </div>
  </div>
</nav>


  <article class="article">

  












  

  
  
  
<div class="article-container pt-3">
  <h1>Plain text accounting tool Beancount in Emacs</h1>

  

  
    



<div class="article-metadata">

  
  

  
  <span class="article-date">
    
    
      
          Last updated on
      
    
    Sep 19, 2019
  </span>
  

  

  
  <span class="middot-divider"></span>
  <span class="article-reading-time">
    7 min read
  </span>
  

  
  
  

  
  

  
    
<div class="share-box" aria-hidden="true">
  <ul class="share">
    
      
      
      
        
      
      
      
      <li>
        <a href="https://twitter.com/intent/tweet?url=/post/444.html/&amp;text=Plain%20text%20accounting%20tool%20Beancount%20in%20Emacs" target="_blank" rel="noopener" class="share-btn-twitter">
          <i class="fab fa-twitter"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.facebook.com/sharer.php?u=/post/444.html/&amp;t=Plain%20text%20accounting%20tool%20Beancount%20in%20Emacs" target="_blank" rel="noopener" class="share-btn-facebook">
          <i class="fab fa-facebook-f"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="mailto:?subject=Plain%20text%20accounting%20tool%20Beancount%20in%20Emacs&amp;body=/post/444.html/" target="_blank" rel="noopener" class="share-btn-email">
          <i class="fas fa-envelope"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.linkedin.com/shareArticle?url=/post/444.html/&amp;title=Plain%20text%20accounting%20tool%20Beancount%20in%20Emacs" target="_blank" rel="noopener" class="share-btn-linkedin">
          <i class="fab fa-linkedin-in"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://web.whatsapp.com/send?text=Plain%20text%20accounting%20tool%20Beancount%20in%20Emacs%20/post/444.html/" target="_blank" rel="noopener" class="share-btn-whatsapp">
          <i class="fab fa-whatsapp"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://service.weibo.com/share/share.php?url=/post/444.html/&amp;title=Plain%20text%20accounting%20tool%20Beancount%20in%20Emacs" target="_blank" rel="noopener" class="share-btn-weibo">
          <i class="fab fa-weibo"></i>
        </a>
      </li>
    
  </ul>
</div>


  

</div>

    














  
</div>



  <div class="article-container">

    <div class="article-style">
      <p>昨天搞定 Emacs 的中文环境，今天想着好久没记帐了，随手记总是很花时间，干脆一鼓作气，将记帐一起搬过来。</p>

<h2 id="复式记帐">复式记帐</h2>

<p>我本科时双修了一门金融，其中最为繁琐，也是最令人头疼的一门课便是会计学。我不爱听讲，毕业之后也将会计的知识点忘得查差不多了，然而其&rdquo;有借必有贷，借贷必相等&rdquo;的复式记帐法，反而是我生活中运用最多的。</p>

<p>复式记帐法说起来复杂，对个人来说，就是将每笔交易分门别类，填入下面这条等式中：</p>

<style>.org-center { margin-left: auto; margin-right: auto; text-align: center; }</style>

<div class="org-center">
  <div></div>

<p>资产 + 费用 = 负债 + 所有者权益 + 收入</p>

<p></div></p>

<p>在个人记帐中，这条等式辅以借贷概念会令人望而生畏，所以我将其略一变形：</p>

<style>.org-center { margin-left: auto; margin-right: auto; text-align: center; }</style>

<div class="org-center">
  <div></div>

<p>（+资产）+（-负债）+（+费用）+（-收入）+（-所有者权益）= 0</p>

<p></div></p>

<ul>
<li>资产与负债都是与金钱直接挂钩的，比如银行户头，比如人民币美钞，比如信用卡帐户，再比如借条，这些都可以算是货币的不同表示形式。</li>
<li>费用与收入则是与金钱间接挂钩的，比如工资，比如商品，比如服务，这些都可以算是生产资本与商品资本的不同表现形式。其中收入与字面意思不同，可以理解为生产资本（劳动力等）。</li>
<li>所有者权益对个人意义不大，一般用来记录历史盈余与糊涂帐。</li>
</ul>

<p>而这个变形公式中的正负号，则可以将各项目的符号关系，用作资金流向的参照。这么说有点玄乎，换个茨威格式的说法就是：&rdquo;人们从命运得到的一切，冥冥之中都记下了它的价钱。&rdquo;花钱买了服务，则是减少资产（花了钱），增加费用（得到服务）；工资到帐，则是增加资产（到帐），减少收入（既有劳动时间的减少）；别人跟你借了钱，则是资产减少（银行帐户或现金余额减少），负债增加（别人在你这儿的负债）。</p>

<p>总结一下，由于人类暂时无法操控时间，所以费用一般为正，收入一般为负。而没有破产的情况下资产一般为正，别人欠你的钱为正，信用卡债（你欠别人的钱）为负。</p>

<h2 id="随手记帐本导出">随手记帐本导出</h2>

<p>刚来美帝我就开始用随手记，一晃也七年过去了（随手记提醒：今天是您记帐的2524天）。虽然作为强迫症的我有着非常完整的消费记录，但是这也带来了非常大的迁移成本。随手记的问题在于想要使用复式记帐时，需要通过结算中转来完成一对多的转帐操作，在聚餐或者帮别人付钱的时候比较麻烦。所以每周都需要花费大量时间来输入帐单，费时费力。</p>

<p>首先尝试从随手记 app 导出，设置－高级功能－备份与同步－备份与恢复－本地备份与恢复－WIFI备份，得到一个 <code>.kbf</code> 文件，将其后缀改为 <code>.zip</code> ，解压得到一个 <code>.sqlite</code> 文件。然而此文件经过加密，打开并不容易。</p>

<p>不过在那个入口还看到导出 EXCEL 文件的选项，乃会员专享，恰好首月免费，我又去意已决，遂开通并获取文件。</p>

<h2 id="记帐方式选择">记帐方式选择</h2>

<p>有了之前的记录，就可以着手选择一款好用的记帐软件了。虽然有可以连接 postgresql 的记帐软件 gnucash，但我还是想用 Emacs 来进行记录操作。网上一搜，有一个 <a href="https://plaintextaccounting.org/" target="_blank">Plain Text Accounting</a> 网站做了详尽的整合。一路看下来，虽然 Ledger 是老前辈，可是 Beancount 的前端 Fava 效果实在好看，有这么一个轮子，为何不用呢？同时还搜到了一位中文博主 wzyboy 的三年的使用经验（<a href="https://wzyboy.im/post/1063.html" target="_blank">Beancount &mdash;&mdash; 命令行复式簿记</a>，<a href="https://wzyboy.im/post/1317.html" target="_blank">使用 Beancount 记录证券投资</a>），感觉非常不错，遂选定 Beancount。</p>

<pre><code class="language-shell">$ pip install beancount
$ pip install fava
</code></pre>

<p>然而 pip 安装方式有两个问题，一是更新不如 source code 频繁，而是不带有 elisp code。若是自己 makefile，由于作者使用仅支持 Python 2.7 的 Mercurial 进行分布式文件管理，如何将 bitbucket 上得到的 sourse code 保持更新也是比较让人头疼的事。我只能暂时将 <code>.el</code> 文件下载下来，以后手动进行更新，较为折腾。</p>

<pre><code class="language-lisp">(add-to-list 'load-path &quot;/path/to/elisp/file/&quot;)
  (require 'beancount)
  (add-to-list 'auto-mode-alist '(&quot;\\.bean\\'&quot; . beancount-mode))
</code></pre>

<h2 id="帐本结构">帐本结构</h2>

<p>由于我已经通过随手记记了七年的帐，所以如果采用单一帐本的话，一方面会导致主帐本过于臃肿，另一方面也会给帐本导入增加障碍。经过考量，我的帐本结构如主帐本文件所示是这样的：</p>

<pre><code class="language-beancount">option &quot;title&quot; &quot;我的帐本&quot;
option &quot;operating_currency&quot; &quot;USD&quot; ; 这样在前端USD外的货币会共享一栏

include &quot;accounts.bean&quot; ; 货币相关的资产（Assets）负债（Liabilities）
include &quot;items.bean&quot; ; 资本相关的收入（Income）费用（Expenses）
include &quot;commodities.bean&quot; ; 货币
include &quot;balances.bean&quot; ; 对帐记录

include &quot;2019.bean&quot; ; 记录每年普通帐目

include &quot;event/event-a.bean&quot; ; 记录事件帐目（旅游为主）

include &quot;points/bank-a.bean&quot; ; 记录里程、积分、礼品卡、预扣款等
</code></pre>

<h2 id="随手记帐本导入">随手记帐本导入</h2>

<p>随手记帐本导出后是一个 EXCEL 文件，含有交易种类、类别、子类、帐户 1、帐户 2、花费、人员、商家、事件、日期、详细这些列，所以我的导入思路是：</p>

<ul>
<li><p>建立两个字典 <code>account_dict</code> 与 <code>item_dict</code> ，分别用于转换帐户1/2与子类；</p></li>

<li><p>通过不同交易种类判断交易条目的正负号：</p>

<table>
<thead>
<tr>
<th>交易种类</th>
<th>子类</th>
<th>帐户1</th>
<th>帐户2</th>
</tr>
</thead>

<tbody>
<tr>
<td>支出</td>
<td>+</td>
<td>-</td>
<td></td>
</tr>

<tr>
<td>收入</td>
<td>-</td>
<td>+</td>
<td></td>
</tr>

<tr>
<td>转帐</td>
<td></td>
<td>-</td>
<td>+</td>
</tr>
</tbody>
</table></li>

<li><p>逐行读取 CSV 文档并转换为 beancount 记帐格式并存储于每年的文件或事件文件中，同时记录四大项目的开始时间与事件标签；</p>

<p>如:</p>

<pre><code class="language-csv">      支出,日常,Hannaford,Chase Freedom,,12.34,,Hannaford,,1/1/19,
</code></pre>

<p>则转换为:</p>

<pre><code class="language-beancount">2019-01-01 * &quot;Hannaford&quot; &quot;支出&quot;
  Expenses:Grocery:Hannaford   +12.34 USD
  Liabilities:US:Chase:Freedom -12.34 USD
</code></pre>

<p>之前使用随手记的时候，我使用&rdquo;结算中转&rdquo;条目来记录复杂交易。而在 beancount 中，由于复杂交易可以直接记录在一个交易事件中，这个&rdquo;结算中转&rdquo;其实没什么用处了。所以在导入帐本时，我将当日产生的结算事件都暂存在一个列表中，如果总额为 0，则仅记录其他类别/帐目的行为，添加 flag 并将&rdquo;详细&rdquo;做为注释记录在行为右边，如果不为 0,则添加 flag 并原样输出，后期再做修改。如:</p>

<pre><code class="language-csv">      转账,,,Chase Freedom,结算中转,12.34,,Hannaford,,1/1/19,买菜
      转账,,,结算中转,朋友A,2.34,,Hannaford,,1/1/19,水果
      转账,,,结算中转,朋友B,5.55,,Hannaford,,1/1/19,蔬菜
      支出,日常,Hannaford,结算中转,,6.45,,Hannaford,,1/1/19,鸡蛋
</code></pre>

<p>则转换为:</p>

<pre><code class="language-beancount">2019-01-01 ! &quot;Hannaford&quot; &quot;买菜 水果 蔬菜 鸡蛋&quot;
  Liabilities:US:Chase:Freedom -12.34 USD ; 买菜
  Liabilities:Payables:A        +2.34 USD ; 水果
  Liabilities:Payables:B        +5.55 USD ; 蔬菜
  Expenses:Grocery:Hannaford    +6.45 USD ; 鸡蛋
</code></pre></li>

<li><p>生成 <code>accounts.bean</code> 、 <code>items.bean</code> 、 <code>balances.bean</code> 与主帐本 <code>main.bean</code> ；</p>

<p><code>balances.bean</code> 比较特殊，用于核对帐目。可以通过银行对帐单自动生成，但是由于我 17 年后的对帐单都没下载到本地来，所以直接在下载的同时手动输入数额了。由于 balance 仅核算当日以前的交易，所以有时需要修改 balance 日期来避免错误提示。</p>

<pre><code class="language-beancount">2019-01-11 balance Liabilities:US:Chase:Freedom -123.45 USD
</code></pre>

<p>对于现金来说由于比较零散，也不一定留有小票，所以我会用 pad 补齐：</p>

<pre><code class="language-beancount">2019-01-31 pad Assets:US:Cash Expenses:Grocery:Other
2019-02-01 balance Assets:US:Cash +50 USD
</code></pre></li>

<li><p>对于货币种类进行核算。</p>

<p>随手记导出的文件有个问题是不会记录货币种类，所以需要后期对涉及多货币的交易进行核对与修改，比如我帮国内的朋友 c 买了东西，对方还我人民币的话，可以记成：</p>

<pre><code class="language-beancount">2019-01-01 * &quot;&quot; &quot;C还钱&quot;
  Assets:CN:Cash  +68 CNY
  Liabilities:Payables:C -10 USD @@ 68 CNY
</code></pre></li>
</ul>

<h2 id="查看报表">查看报表</h2>

<p>Beancount 自带 <code>bean-web main.bean</code> 语句，可以在 <a href="http://localhost:8080/" target="_blank">http://localhost:8080/</a> 查看简单报表。 不过装了 fava 的我，便可以欢乐地使用 <code>fava main.bean</code> 语句，在 <a href="http://localhost:5000/" target="_blank">http://localhost:5000/</a> 查看比较华丽的报表。<a href="https://fava.pythonanywhere.com/example-beancount-file/trial%5Fbalance/" target="_blank">这里</a> 有官方演示，效果拔群。</p>

<h2 id="快捷记账">快捷记账</h2>

<p>我写了一个简单的 <code>org-capture-templates</code> ，这样就可以通过 <kbd>C-c c-b</kbd> 来进行快捷记账。</p>

<pre><code class="language-lisp">(setq org-capture-templates
      ' ((&quot;b&quot; &quot;Beancount&quot; plain
          (file &quot;~/Dropbox/Beancount/2019.bean&quot;)
          &quot;
%(org-read-date) %^{标识|*|!} \&quot;%^{商户}\&quot; \&quot;%^{描述}\&quot;
  %^{借记||Expenses:Grocery:Hannaford|Expenses:Grocery:Other|Expenses:Restaurant|Income:Paycheck|Assets:US:Cash|Assets:CN:Cash|Liabilities:Payables:A|Liabilities:Payables:B|Liabilities:Payables:C|Liabilities:US:Chase:Freedom}  +%^{金额} USD
  %^{贷记||Expenses:Grocery:Hannaford|Expenses:Grocery:Other|Expenses:Restaurant|Income:Paycheck|Assets:US:Cash|Assets:CN:Cash|Liabilities:Payables:A|Liabilities:Payables:B|Liabilities:Payables:C|Liabilities:US:Chase:Freedom}  -%^{金额} USD&quot;)))
</code></pre>

<p>不过在这个模板中，帐户名称需要自定义，比较麻烦，不能通用。未来我会尝试写一个 lisp function 来优化，希望能够实现：</p>

<ol>
<li>记帐不限条目，可记录多项事件于同一笔交易中；</li>
<li>自动读取 <code>accounts.bean</code> 与 <code>items.bean</code> 文件中的项目并作为备选；</li>
<li>自动对齐金额。</li>
</ol>
    </div>

    


    

<div class="article-tags">
  
  <a class="badge badge-light" href="/tags/emacs/">Emacs</a>
  
  <a class="badge badge-light" href="/tags/python/">Python</a>
  
  <a class="badge badge-light" href="/tags/beancount/">Beancount</a>
  
</div>



    
      








  






  
  
  
    
  
  
  <div class="media author-card">
    
      
      <img class="portrait mr-3" src="/authors/admin/avatar_hu8d2ecfec5daac15b322d8551e4669aa2_8959_250x250_fill_q90_lanczos_center.jpeg" alt="Avatar">
    

    <div class="media-body">
      <h5 class="card-title"><a href="/">Runhan Yu</a></h5>
      <h6 class="card-subtitle">Data Engineer</h6>
      <p class="card-text">My interests include software development, big data, cloud computing and biochemistry.</p>
      <ul class="network-icon" aria-hidden="true">
        
          
          
          
            
          
          
          
          
          
            
          
          <li>
            <a href="https://github.com/ziyunch" target="_blank" rel="noopener">
              <i class="fab fa-github"></i>
            </a>
          </li>
        
          
          
          
            
          
          
          
          
          
            
          
          <li>
            <a href="https://www.linkedin.com/in/runhanyu/" target="_blank" rel="noopener">
              <i class="fab fa-linkedin"></i>
            </a>
          </li>
        
          
          
          
            
          
          
          
          
          
            
          
          <li>
            <a href="/#contact" >
              <i class="fas fa-envelope"></i>
            </a>
          </li>
        
          
          
          
          
          
          
          
            
          
          <li>
            <a href="https://scholar.google.com/citations?user=iuNw-9YAAAAJ" target="_blank" rel="noopener">
              <i class="ai ai-google-scholar"></i>
            </a>
          </li>
        
          
          
          
          
          
          
          
            
          
          <li>
            <a href="/files/Runhan-Yu-SDE.pdf" >
              <i class="ai ai-cv"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>



      
      
      <div class="article-widget">
        <div class="hr-light"></div>
        <h3>Related</h3>
        <ul>
          
          <li><a href="/post/443.html/">Emacs configuration with support for Chinese input</a></li>
          
          <li><a href="/project/rxminer/">RxMiner</a></li>
          
          <li><a href="/project/csv2bean/">CSV2Bean</a></li>
          
          <li><a href="/project/multicrawler/">Multithread Web Crawler</a></li>
          
          <li><a href="/project/gistic/">Gene Variation Analysis of Stomach Cancer</a></li>
          
        </ul>
      </div>
      
    

    

    


  </div>
</article>

      

    
    

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.js" integrity="sha256-X5PoE3KU5l+JcX+w09p/wHl9AzK333C4hJ2I9S5mD4M=" crossorigin="anonymous"></script>

      

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/highlight.min.js" integrity="sha256-aYTdUrn6Ow1DDgh5JTc3aDGnnju48y/1c8s1dgkYPQ8=" crossorigin="anonymous"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/languages/r.min.js"></script>
        
      

      
      
    

    
    

    
    
    <script>hljs.initHighlightingOnLoad();</script>
    

    
    
    <script>
      const search_index_filename = "/index.json";
      const i18n = {
        'placeholder': "Search...",
        'results': "results found",
        'no_results': "No results found"
      };
      const content_type = {
        'post': "Posts",
        'project': "Projects",
        'publication' : "Publications",
        'talk' : "Talks"
        };
    </script>
    

    
    

    
    
    <script id="search-hit-fuse-template" type="text/x-template">
      <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
      </div>
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>
    

    
    

    
    

    
    
    
    
    
    
    
    
    
      
    
    
    
    
    <script src="/js/academic.min.130521ecfc6f534c52c158217bbff718.js"></script>

    






  
  <div class="container">
    <footer class="site-footer">
  

  <p class="powered-by">
    

    Powered by the
    <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
    <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.

    
    <span class="float-right" aria-hidden="true">
      <a href="#" id="back_to_top">
        <span class="button_icon">
          <i class="fas fa-chevron-up fa-2x"></i>
        </span>
      </a>
    </span>
    
  </p>
</footer>

  </div>
  

  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

</body>
</html>
